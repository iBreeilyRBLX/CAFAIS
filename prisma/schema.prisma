model VerifiedUser {
  discordId         String   @id
  robloxId          BigInt
  robloxUsername    String
  robloxDisplayName String
  verifiedAt        DateTime @default(now())
  updatedAt         DateTime @updatedAt
  userProfile       UserProfile @relation(fields: [discordId], references: [discordId])
}

model OauthState {
  id             String   @id @default(uuid())
  stateToken     String   @unique
  discordId      String
  discordUserTag String?
  createdAt      DateTime @default(now())
  expiresAt      DateTime @default(dbgenerated("now() + interval '10 minutes'"))
}
// Prisma schema for Discord bot (PostgreSQL)
// Models: UserProfile, Event, EventAttendance, LOA, RankCooldown, RankLock, Award
// Follows best practices for relations and indexing

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model UserProfile {
  discordId    String   @id
  username     String
  discriminator String
  points       Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  eventParticipants EventParticipant[]
  loaRecords   LOA[]
  rankCooldowns RankCooldown[]
  rankLocks    RankLock[]
  awards       Award[]
  applicationSubmissions ApplicationSubmission[]
  verifiedUser VerifiedUser?
  @@index([points])
}

model Event {
  id          String   @id @default(uuid())
  name        String
  description String?
  eventType   String
  eventHostDiscordId String
  notes       String?
  imageLink   String?
  startTime   DateTime
  endTime     DateTime?
  pointsAwarded Int?
  participants EventParticipant[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  @@index([startTime])
  @@index([eventType])
  @@index([eventHostDiscordId])
  @@index([endTime])
}

model EventParticipant {
  id         String      @id @default(uuid())
  eventId    String
  userDiscordId String
  points     Int         @default(0)
  failed     Boolean     @default(false)
  event      Event       @relation(fields: [eventId], references: [id])
  user       UserProfile @relation(fields: [userDiscordId], references: [discordId])
  @@unique([eventId, userDiscordId])
  @@index([eventId])
  @@index([userDiscordId])
  @@index([points])
}

model LOA {
  id         String      @id @default(uuid())
  userDiscordId String
  reason     String
  startDate  DateTime
  endDate    DateTime
  createdAt  DateTime    @default(now())
  user       UserProfile @relation(fields: [userDiscordId], references: [discordId])
  @@index([userDiscordId])
  @@index([endDate])
}

model RankCooldown {
  id         String      @id @default(uuid())
  userDiscordId String
  rank       String
  cooldownUntil DateTime
  createdAt  DateTime    @default(now())
  user       UserProfile @relation(fields: [userDiscordId], references: [discordId])
  @@unique([userDiscordId, rank])
  @@index([userDiscordId])
  @@index([rank])
}

model RankLock {
  id         String      @id @default(uuid())
  userDiscordId String
  rank       String
  lockedAt   DateTime    @default(now())
  reason     String?
  user       UserProfile @relation(fields: [userDiscordId], references: [discordId])
  @@unique([userDiscordId, rank])
  @@index([userDiscordId])
  @@index([rank])
}

model Award {
  id         String      @id @default(uuid())
  userDiscordId String
  name       String
  description String?
  awardedAt  DateTime    @default(now())
  user       UserProfile @relation(fields: [userDiscordId], references: [discordId])
  @@index([userDiscordId])
  @@index([name])
}

model ApplicationSubmission {
  id                String      @id @default(uuid())
  userDiscordId     String
  submissionCount   Int         @default(1)
  isPending         Boolean     @default(true)
  applicationReason String?
  foundServer       String?
  age               String?
  lastDeniedAt      DateTime?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  user              UserProfile @relation(fields: [userDiscordId], references: [discordId], onDelete: Cascade)
  @@unique([userDiscordId])
  @@index([userDiscordId])
  @@index([isPending])
}
